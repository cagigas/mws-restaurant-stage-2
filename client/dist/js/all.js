"use strict";var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var DBHelper=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"fetchRestaurants",value:function(n){var t=new XMLHttpRequest;t.open("GET",e.DATABASE_URL),t.onload=function(){if(200===t.status){var e=JSON.parse(t.responseText).restaurants;n(null,e)}else{var r="Request failed. Returned status of "+t.status;n(r,null)}},t.send()}},{key:"fetchRestaurantById",value:function(n,t){e.fetchRestaurants(function(e,r){if(e)t(e,null);else{var a=r.find(function(e){return e.id==n});a?t(null,a):t("Restaurant does not exist",null)}})}},{key:"fetchRestaurantByCuisine",value:function(n,t){e.fetchRestaurants(function(e,r){if(e)t(e,null);else{var a=r.filter(function(e){return e.cuisine_type==n});t(null,a)}})}},{key:"fetchRestaurantByNeighborhood",value:function(n,t){e.fetchRestaurants(function(e,r){if(e)t(e,null);else{var a=r.filter(function(e){return e.neighborhood==n});t(null,a)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(n,t,r){e.fetchRestaurants(function(e,a){if(e)r(e,null);else{var o=a;"all"!=n&&(o=o.filter(function(e){return e.cuisine_type==n})),"all"!=t&&(o=o.filter(function(e){return e.neighborhood==t})),r(null,o)}})}},{key:"fetchNeighborhoods",value:function(n){e.fetchRestaurants(function(e,t){if(e)n(e,null);else{var r=t.map(function(e,n){return t[n].neighborhood}),a=r.filter(function(e,n){return r.indexOf(e)==n});n(null,a)}})}},{key:"fetchCuisines",value:function(n){e.fetchRestaurants(function(e,t){if(e)n(e,null);else{var r=t.map(function(e,n){return t[n].cuisine_type}),a=r.filter(function(e,n){return r.indexOf(e)==n});n(null,a)}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e){return"/img/"+e.photograph}},{key:"mapMarkerForRestaurant",value:function(n,t){return new google.maps.Marker({position:n.latlng,title:n.name,url:e.urlForRestaurant(n),map:t,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://localhost:3000/data/restaurants.json"}}]),e}();registerServiceWorker=function(){navigator.serviceWorker&&navigator.serviceWorker.register("/sw.js").then(function(){navigator.serviceWorker.controller&&console.log("Registration Worked!")}).catch(function(){console.error("Registration failed!")})},registerServiceWorker();var restaurants=void 0,neighborhoods=void 0,cuisines=void 0,markers=[];document.addEventListener("DOMContentLoaded",function(e){fetchNeighborhoods(),fetchCuisines()}),fetchNeighborhoods=function(){DBHelper.fetchNeighborhoods(function(e,n){e?console.error(e):(self.neighborhoods=n,fillNeighborhoodsHTML())})},fillNeighborhoodsHTML=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.neighborhoods,n=document.getElementById("neighborhoods-select");e.forEach(function(e){var t=document.createElement("option");t.innerHTML=e,t.value=e,n.append(t)})},fetchCuisines=function(){DBHelper.fetchCuisines(function(e,n){e?console.error(e):(self.cuisines=n,fillCuisinesHTML())})},fillCuisinesHTML=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.cuisines,n=document.getElementById("cuisines-select");e.forEach(function(e){var t=document.createElement("option");t.innerHTML=e,t.value=e,n.append(t)})},window.initMap=function(){self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()},updateRestaurants=function(){var e=document.getElementById("cuisines-select"),n=document.getElementById("neighborhoods-select"),t=e.selectedIndex,r=n.selectedIndex,a=e[t].value,o=n[r].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(a,o,function(e,n){e?console.error(e):(resetRestaurants(n),fillRestaurantsHTML())})},resetRestaurants=function(e){self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(function(e){return e.setMap(null)}),self.markers=[],self.restaurants=e},fillRestaurantsHTML=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurants,n=document.getElementById("restaurants-list");e.forEach(function(e){n.append(createRestaurantHTML(e))}),addMarkersToMap()},createRestaurantHTML=function(e){var n=document.createElement("li"),t=document.createElement("img");t.className="restaurant-img",t.alt=e.name+" restaurant's cover photo",t.src=DBHelper.imageUrlForRestaurant(e),n.append(t);var r=document.createElement("h2");r.innerHTML=e.name,n.append(r);var a=document.createElement("p");a.innerHTML=e.neighborhood,n.append(a);var o=document.createElement("p");o.innerHTML=e.address,n.append(o);var i=document.createElement("a");return i.innerHTML="View Details",i.href=DBHelper.urlForRestaurant(e),n.append(i),n},addMarkersToMap=function(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurants).forEach(function(e){var n=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(n,"click",function(){window.location.href=n.url}),self.markers.push(n)})};var map,restaurant=void 0;window.initMap=function(){fetchRestaurantFromURL(function(e,n){e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:n.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})},fetchRestaurantFromURL=function(e){if(self.restaurant)e(null,self.restaurant);else{var n=getParameterByName("id");n?DBHelper.fetchRestaurantById(n,function(n,t){self.restaurant=t,t?(fillRestaurantHTML(),e(null,t)):console.error(n)}):(error="No restaurant id in URL",e(error,null))}},fillRestaurantHTML=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurant;document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;var n=document.getElementById("restaurant-img");n.className="restaurant-img",n.alt=e.name+" restaurant's cover photo",n.src=DBHelper.imageUrlForRestaurant(e),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()},fillRestaurantHoursHTML=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,n=document.getElementById("restaurant-hours");for(var t in e){var r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=t,r.appendChild(a);var o=document.createElement("td");o.innerHTML=e[t],r.appendChild(o),n.appendChild(r)}},fillReviewsHTML=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurant.reviews,n=document.getElementById("reviews-container"),t=document.createElement("h2");if(t.innerHTML="Reviews",n.appendChild(t),!e){var r=document.createElement("p");return r.innerHTML="No reviews yet!",void n.appendChild(r)}var a=document.getElementById("reviews-list");e.forEach(function(e){a.appendChild(createReviewHTML(e))}),n.appendChild(a)},createReviewHTML=function(e){var n=document.createElement("li"),t=document.createElement("p");t.innerHTML=e.name;var r=document.createElement("p");r.innerHTML=e.date,r.id="restaurant-date";var a=document.createElement("ul");a.id="restaurant-basic-nav",a.appendChild(t),a.appendChild(r),n.appendChild(a);var o=document.createElement("p");o.innerHTML="Rating: "+e.rating,o.id="restaurant-rating",n.appendChild(o);var i=document.createElement("p");return i.innerHTML=e.comments,i.id="restaurant-comment",n.appendChild(i),n.tabIndex="0",n},fillBreadcrumb=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurant,n=document.getElementById("breadcrumb"),t=document.createElement("li");t.innerHTML=e.name,n.appendChild(t)},getParameterByName=function(e,n){n||(n=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(n);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIiwiSW5kZXhDb250cm9sbGVyLmpzIiwibWFpbi5qcyIsInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJEQkhlbHBlciIsImNhbGxiYWNrIiwieGhyIiwiWE1MSHR0cFJlcXVlc3QiLCJvcGVuIiwiREFUQUJBU0VfVVJMIiwib25sb2FkIiwic3RhdHVzIiwicmVzdGF1cmFudHMiLCJKU09OIiwicGFyc2UiLCJyZXNwb25zZVRleHQiLCJlcnJvciIsInNlbmQiLCJpZCIsImZldGNoUmVzdGF1cmFudHMiLCJyZXN0YXVyYW50IiwiZmluZCIsInIiLCJjdWlzaW5lIiwicmVzdWx0cyIsImZpbHRlciIsImN1aXNpbmVfdHlwZSIsIm5laWdoYm9yaG9vZCIsIm5laWdoYm9yaG9vZHMiLCJtYXAiLCJ2IiwiaSIsInVuaXF1ZU5laWdoYm9yaG9vZHMiLCJpbmRleE9mIiwiY3Vpc2luZXMiLCJ1bmlxdWVDdWlzaW5lcyIsInBob3RvZ3JhcGgiLCJnb29nbGUiLCJtYXBzIiwiTWFya2VyIiwicG9zaXRpb24iLCJsYXRsbmciLCJ0aXRsZSIsIm5hbWUiLCJ1cmwiLCJ1cmxGb3JSZXN0YXVyYW50IiwiYW5pbWF0aW9uIiwiQW5pbWF0aW9uIiwiRFJPUCIsInJlZ2lzdGVyU2VydmljZVdvcmtlciIsIm5hdmlnYXRvciIsInNlcnZpY2VXb3JrZXIiLCJyZWdpc3RlciIsInRoZW4iLCJjb250cm9sbGVyIiwiY29uc29sZSIsImxvZyIsImNhdGNoIiwibWFya2VycyIsImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwiZmV0Y2hOZWlnaGJvcmhvb2RzIiwiZmV0Y2hDdWlzaW5lcyIsInNlbGYiLCJmaWxsTmVpZ2hib3Job29kc0hUTUwiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJzZWxlY3QiLCJnZXRFbGVtZW50QnlJZCIsImZvckVhY2giLCJvcHRpb24iLCJjcmVhdGVFbGVtZW50IiwiaW5uZXJIVE1MIiwidmFsdWUiLCJhcHBlbmQiLCJmaWxsQ3Vpc2luZXNIVE1MIiwid2luZG93IiwiaW5pdE1hcCIsIk1hcCIsInpvb20iLCJjZW50ZXIiLCJsYXQiLCJsbmciLCJzY3JvbGx3aGVlbCIsInVwZGF0ZVJlc3RhdXJhbnRzIiwiY1NlbGVjdCIsIm5TZWxlY3QiLCJjSW5kZXgiLCJzZWxlY3RlZEluZGV4IiwibkluZGV4IiwiZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kIiwicmVzZXRSZXN0YXVyYW50cyIsImZpbGxSZXN0YXVyYW50c0hUTUwiLCJtIiwic2V0TWFwIiwidWwiLCJjcmVhdGVSZXN0YXVyYW50SFRNTCIsImFkZE1hcmtlcnNUb01hcCIsImxpIiwiaW1hZ2UiLCJjbGFzc05hbWUiLCJhbHQiLCJzcmMiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJhZGRyZXNzIiwibW9yZSIsImhyZWYiLCJtYXJrZXIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwiYWRkTGlzdGVuZXIiLCJsb2NhdGlvbiIsInB1c2giLCJmZXRjaFJlc3RhdXJhbnRGcm9tVVJMIiwiZmlsbEJyZWFkY3J1bWIiLCJnZXRQYXJhbWV0ZXJCeU5hbWUiLCJmZXRjaFJlc3RhdXJhbnRCeUlkIiwiZmlsbFJlc3RhdXJhbnRIVE1MIiwib3BlcmF0aW5nX2hvdXJzIiwiZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwiLCJmaWxsUmV2aWV3c0hUTUwiLCJvcGVyYXRpbmdIb3VycyIsImhvdXJzIiwia2V5Iiwicm93IiwiZGF5IiwiYXBwZW5kQ2hpbGQiLCJ0aW1lIiwicmV2aWV3cyIsImNvbnRhaW5lciIsIm5vUmV2aWV3cyIsInJldmlldyIsImNyZWF0ZVJldmlld0hUTUwiLCJkYXRlIiwicmF0aW5nIiwiY29tbWVudHMiLCJ0YWJJbmRleCIsImJyZWFkY3J1bWIiLCJyZXBsYWNlIiwiUmVnRXhwIiwiZXhlYyIsImRlY29kZVVSSUNvbXBvbmVudCJdLCJtYXBwaW5ncyI6ImlZQUdNQSw0SEFjb0JDLEdBQ3RCLElBQUlD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QUs1QyxXQUMxQnNILEVBQWEvRSxTQUFTVyxlQUFlLGNBQ3JDOEIsRUFBS3pDLFNBQVNjLGNBQWMsTUFDbEMyQixFQUFHMUIsVUFBWXRELEVBQVd1QixLQUMxQitGLEVBQVdYLFlBQVkzQixJQU16QmdCLG1CQUFxQixTQUFDekUsRUFBTUMsR0FDckJBLElBQ0hBLEVBQU1rQyxPQUFPa0MsU0FBU0osTUFDeEJqRSxFQUFPQSxFQUFLZ0csUUFBUSxVQUFXLFFBQy9CLElBQ0VuSCxFQURZLElBQUlvSCxPQUFKLE9BQWtCakcsRUFBbEIscUJBQ0lrRyxLQUFLakcsR0FDdkIsT0FBS3BCLEVBRUFBLEVBQVEsR0FFTnNILG1CQUFtQnRILEVBQVEsR0FBR21ILFFBQVEsTUFBTyxNQUQzQyxHQUZBIiwiZmlsZSI6ImFsbC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cclxuICovXHJcbmNsYXNzIERCSGVscGVyIHtcclxuXHJcbiAgLyoqXHJcbiAgICogRGF0YWJhc2UgVVJMLlxyXG4gICAqIENoYW5nZSB0aGlzIHRvIHJlc3RhdXJhbnRzLmpzb24gZmlsZSBsb2NhdGlvbiBvbiB5b3VyIHNlcnZlci5cclxuICAgKi9cclxuICBzdGF0aWMgZ2V0IERBVEFCQVNFX1VSTCgpIHtcclxuICAgIGNvbnN0IHBvcnQgPSAzMDAwIC8vIENoYW5nZSB0aGlzIHRvIHlvdXIgc2VydmVyIHBvcnRcclxuICAgIHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9L2RhdGEvcmVzdGF1cmFudHMuanNvbmA7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgcmVzdGF1cmFudHMuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudHMoY2FsbGJhY2spIHtcclxuICAgIGxldCB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcclxuICAgIHhoci5vcGVuKCdHRVQnLCBEQkhlbHBlci5EQVRBQkFTRV9VUkwpO1xyXG4gICAgeGhyLm9ubG9hZCA9ICgpID0+IHtcclxuICAgICAgaWYgKHhoci5zdGF0dXMgPT09IDIwMCkgeyAvLyBHb3QgYSBzdWNjZXNzIHJlc3BvbnNlIGZyb20gc2VydmVyIVxyXG4gICAgICAgIGNvbnN0IGpzb24gPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpO1xyXG4gICAgICAgIGNvbnN0IHJlc3RhdXJhbnRzID0ganNvbi5yZXN0YXVyYW50cztcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50cyk7XHJcbiAgICAgIH0gZWxzZSB7IC8vIE9vcHMhLiBHb3QgYW4gZXJyb3IgZnJvbSBzZXJ2ZXIuXHJcbiAgICAgICAgY29uc3QgZXJyb3IgPSAoYFJlcXVlc3QgZmFpbGVkLiBSZXR1cm5lZCBzdGF0dXMgb2YgJHt4aHIuc3RhdHVzfWApO1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIHhoci5zZW5kKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCBjYWxsYmFjaykge1xyXG4gICAgLy8gZmV0Y2ggYWxsIHJlc3RhdXJhbnRzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCByZXN0YXVyYW50ID0gcmVzdGF1cmFudHMuZmluZChyID0+IHIuaWQgPT0gaWQpO1xyXG4gICAgICAgIGlmIChyZXN0YXVyYW50KSB7IC8vIEdvdCB0aGUgcmVzdGF1cmFudFxyXG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XHJcbiAgICAgICAgfSBlbHNlIHsgLy8gUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCBpbiB0aGUgZGF0YWJhc2VcclxuICAgICAgICAgIGNhbGxiYWNrKCdSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0JywgbnVsbCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSB0eXBlIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmUoY3Vpc2luZSwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyAgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBjdWlzaW5lIHR5cGVcclxuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5TmVpZ2hib3Job29kKG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIG5laWdoYm9yaG9vZFxyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbGV0IHJlc3VsdHMgPSByZXN0YXVyYW50c1xyXG4gICAgICAgIGlmIChjdWlzaW5lICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBjdWlzaW5lXHJcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG5laWdoYm9yaG9vZCAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgbmVpZ2hib3Job29kXHJcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hOZWlnaGJvcmhvb2RzKGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gR2V0IGFsbCBuZWlnaGJvcmhvb2RzIGZyb20gYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgICAgY29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0ubmVpZ2hib3Job29kKVxyXG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xyXG4gICAgICAgIGNvbnN0IHVuaXF1ZU5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzLmZpbHRlcigodiwgaSkgPT4gbmVpZ2hib3Job29kcy5pbmRleE9mKHYpID09IGkpXHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlTmVpZ2hib3Job29kcyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIGN1aXNpbmVzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaEN1aXNpbmVzKGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICAgIGNvbnN0IGN1aXNpbmVzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5jdWlzaW5lX3R5cGUpXHJcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBjdWlzaW5lc1xyXG4gICAgICAgIGNvbnN0IHVuaXF1ZUN1aXNpbmVzID0gY3Vpc2luZXMuZmlsdGVyKCh2LCBpKSA9PiBjdWlzaW5lcy5pbmRleE9mKHYpID09IGkpXHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlQ3Vpc2luZXMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgcGFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIHVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIChgLi9yZXN0YXVyYW50Lmh0bWw/aWQ9JHtyZXN0YXVyYW50LmlkfWApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBpbWFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIGltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gKGAvaW1nLyR7cmVzdGF1cmFudC5waG90b2dyYXBofWApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTWFwIG1hcmtlciBmb3IgYSByZXN0YXVyYW50LlxyXG4gICAqL1xyXG4gIHN0YXRpYyBtYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIG1hcCkge1xyXG4gICAgY29uc3QgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XHJcbiAgICAgIHBvc2l0aW9uOiByZXN0YXVyYW50LmxhdGxuZyxcclxuICAgICAgdGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcclxuICAgICAgdXJsOiBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpLFxyXG4gICAgICBtYXA6IG1hcCxcclxuICAgICAgYW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUH1cclxuICAgICk7XHJcbiAgICByZXR1cm4gbWFya2VyO1xyXG4gIH1cclxuXHJcbn1cclxuIiwicmVnaXN0ZXJTZXJ2aWNlV29ya2VyID0gKCkgPT4ge1xyXG4gIGlmICghbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIpIHJldHVyblxyXG5cclxuICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3RlcignL3N3LmpzJykudGhlbihmdW5jdGlvbiAoLypyZWcqLykge1xyXG4gICAgaWYgKCFuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5jb250cm9sbGVyKSB7XHJcbiAgICAgIHJldHVyblxyXG4gICAgfVxyXG4gICAgY29uc29sZS5sb2coJ1JlZ2lzdHJhdGlvbiBXb3JrZWQhJylcclxuXHJcbiAgfSkuY2F0Y2goZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc29sZS5lcnJvcignUmVnaXN0cmF0aW9uIGZhaWxlZCEnKVxyXG4gIH0pXHJcbn1cclxuXHJcbnJlZ2lzdGVyU2VydmljZVdvcmtlcigpXHJcbiIsImxldCByZXN0YXVyYW50cyxcclxuICBuZWlnaGJvcmhvb2RzLFxyXG4gIGN1aXNpbmVzXHJcbnZhciBtYXBcclxudmFyIG1hcmtlcnMgPSBbXVxyXG5cclxuLyoqXHJcbiAqIEZldGNoIG5laWdoYm9yaG9vZHMgYW5kIGN1aXNpbmVzIGFzIHNvb24gYXMgdGhlIHBhZ2UgaXMgbG9hZGVkLlxyXG4gKi9cclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIChldmVudCkgPT4ge1xyXG4gIGZldGNoTmVpZ2hib3Job29kcygpO1xyXG4gIGZldGNoQ3Vpc2luZXMoKTtcclxufSk7XHJcblxyXG4vKipcclxuICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgYW5kIHNldCB0aGVpciBIVE1MLlxyXG4gKi9cclxuZmV0Y2hOZWlnaGJvcmhvb2RzID0gKCkgPT4ge1xyXG4gIC8vdmFyIGZvbyA9IDEyMztcclxuICBEQkhlbHBlci5mZXRjaE5laWdoYm9yaG9vZHMoKGVycm9yLCBuZWlnaGJvcmhvb2RzKSA9PiB7XHJcbiAgICBpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yXHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc2VsZi5uZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcztcclxuICAgICAgZmlsbE5laWdoYm9yaG9vZHNIVE1MKCk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTZXQgbmVpZ2hib3Job29kcyBIVE1MLlxyXG4gKi9cclxuZmlsbE5laWdoYm9yaG9vZHNIVE1MID0gKG5laWdoYm9yaG9vZHMgPSBzZWxmLm5laWdoYm9yaG9vZHMpID0+IHtcclxuICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmVpZ2hib3Job29kcy1zZWxlY3QnKTtcclxuICBuZWlnaGJvcmhvb2RzLmZvckVhY2gobmVpZ2hib3Job29kID0+IHtcclxuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xyXG4gICAgb3B0aW9uLmlubmVySFRNTCA9IG5laWdoYm9yaG9vZDtcclxuICAgIG9wdGlvbi52YWx1ZSA9IG5laWdoYm9yaG9vZDtcclxuICAgIHNlbGVjdC5hcHBlbmQob3B0aW9uKTtcclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEZldGNoIGFsbCBjdWlzaW5lcyBhbmQgc2V0IHRoZWlyIEhUTUwuXHJcbiAqL1xyXG5mZXRjaEN1aXNpbmVzID0gKCkgPT4ge1xyXG4gIERCSGVscGVyLmZldGNoQ3Vpc2luZXMoKGVycm9yLCBjdWlzaW5lcykgPT4ge1xyXG4gICAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvciFcclxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzZWxmLmN1aXNpbmVzID0gY3Vpc2luZXM7XHJcbiAgICAgIGZpbGxDdWlzaW5lc0hUTUwoKTtcclxuICAgIH1cclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFNldCBjdWlzaW5lcyBIVE1MLlxyXG4gKi9cclxuZmlsbEN1aXNpbmVzSFRNTCA9IChjdWlzaW5lcyA9IHNlbGYuY3Vpc2luZXMpID0+IHtcclxuICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vpc2luZXMtc2VsZWN0Jyk7XHJcblxyXG4gIGN1aXNpbmVzLmZvckVhY2goY3Vpc2luZSA9PiB7XHJcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcclxuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBjdWlzaW5lO1xyXG4gICAgb3B0aW9uLnZhbHVlID0gY3Vpc2luZTtcclxuICAgIHNlbGVjdC5hcHBlbmQob3B0aW9uKTtcclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEluaXRpYWxpemUgR29vZ2xlIG1hcCwgY2FsbGVkIGZyb20gSFRNTC5cclxuICovXHJcbndpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xyXG4gIGxldCBsb2MgPSB7XHJcbiAgICBsYXQ6IDQwLjcyMjIxNixcclxuICAgIGxuZzogLTczLjk4NzUwMVxyXG4gIH07XHJcbiAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xyXG4gICAgem9vbTogMTIsXHJcbiAgICBjZW50ZXI6IGxvYyxcclxuICAgIHNjcm9sbHdoZWVsOiBmYWxzZVxyXG4gIH0pO1xyXG4gIHVwZGF0ZVJlc3RhdXJhbnRzKCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBVcGRhdGUgcGFnZSBhbmQgbWFwIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzLlxyXG4gKi9cclxudXBkYXRlUmVzdGF1cmFudHMgPSAoKSA9PiB7XHJcbiAgY29uc3QgY1NlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcclxuICBjb25zdCBuU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XHJcblxyXG4gIGNvbnN0IGNJbmRleCA9IGNTZWxlY3Quc2VsZWN0ZWRJbmRleDtcclxuICBjb25zdCBuSW5kZXggPSBuU2VsZWN0LnNlbGVjdGVkSW5kZXg7XHJcblxyXG4gIGNvbnN0IGN1aXNpbmUgPSBjU2VsZWN0W2NJbmRleF0udmFsdWU7XHJcbiAgY29uc3QgbmVpZ2hib3Job29kID0gblNlbGVjdFtuSW5kZXhdLnZhbHVlO1xyXG5cclxuICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kLCAoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICBpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yIVxyXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJlc2V0UmVzdGF1cmFudHMocmVzdGF1cmFudHMpO1xyXG4gICAgICBmaWxsUmVzdGF1cmFudHNIVE1MKCk7XHJcbiAgICB9XHJcbiAgfSlcclxufVxyXG5cclxuLyoqXHJcbiAqIENsZWFyIGN1cnJlbnQgcmVzdGF1cmFudHMsIHRoZWlyIEhUTUwgYW5kIHJlbW92ZSB0aGVpciBtYXAgbWFya2Vycy5cclxuICovXHJcbnJlc2V0UmVzdGF1cmFudHMgPSAocmVzdGF1cmFudHMpID0+IHtcclxuICAvLyBSZW1vdmUgYWxsIHJlc3RhdXJhbnRzXHJcbiAgc2VsZi5yZXN0YXVyYW50cyA9IFtdO1xyXG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcclxuICB1bC5pbm5lckhUTUwgPSAnJztcclxuXHJcbiAgLy8gUmVtb3ZlIGFsbCBtYXAgbWFya2Vyc1xyXG4gIHNlbGYubWFya2Vycy5mb3JFYWNoKG0gPT4gbS5zZXRNYXAobnVsbCkpO1xyXG4gIHNlbGYubWFya2VycyA9IFtdO1xyXG4gIHNlbGYucmVzdGF1cmFudHMgPSByZXN0YXVyYW50cztcclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSBhbGwgcmVzdGF1cmFudHMgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5maWxsUmVzdGF1cmFudHNIVE1MID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xyXG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcclxuICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgdWwuYXBwZW5kKGNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpKTtcclxuICB9KTtcclxuICBhZGRNYXJrZXJzVG9NYXAoKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwuXHJcbiAqL1xyXG5jcmVhdGVSZXN0YXVyYW50SFRNTCA9IChyZXN0YXVyYW50KSA9PiB7XHJcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xyXG5cclxuICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xyXG4gIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyc7XHJcbiAgaW1hZ2UuYWx0ID0gcmVzdGF1cmFudC5uYW1lICsgXCIgcmVzdGF1cmFudCdzIGNvdmVyIHBob3RvXCJcclxuICBpbWFnZS5zcmMgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XHJcbiAgbGkuYXBwZW5kKGltYWdlKTtcclxuXHJcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gyJyk7XHJcbiAgbmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XHJcblxyXG4gIGxpLmFwcGVuZChuYW1lKTtcclxuXHJcbiAgY29uc3QgbmVpZ2hib3Job29kID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIG5laWdoYm9yaG9vZC5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5laWdoYm9yaG9vZDtcclxuICBsaS5hcHBlbmQobmVpZ2hib3Job29kKTtcclxuXHJcbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcclxuICBsaS5hcHBlbmQoYWRkcmVzcyk7XHJcblxyXG4gIGNvbnN0IG1vcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XHJcbiAgbW9yZS5pbm5lckhUTUwgPSAnVmlldyBEZXRhaWxzJztcclxuICBtb3JlLmhyZWYgPSBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG4gIGxpLmFwcGVuZChtb3JlKVxyXG5cclxuICByZXR1cm4gbGlcclxufVxyXG5cclxuLyoqXHJcbiAqIEFkZCBtYXJrZXJzIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzIHRvIHRoZSBtYXAuXHJcbiAqL1xyXG5hZGRNYXJrZXJzVG9NYXAgPSAocmVzdGF1cmFudHMgPSBzZWxmLnJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcclxuICAgIC8vIEFkZCBtYXJrZXIgdG8gdGhlIG1hcFxyXG4gICAgY29uc3QgbWFya2VyID0gREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBzZWxmLm1hcCk7XHJcbiAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXJrZXIsICdjbGljaycsICgpID0+IHtcclxuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBtYXJrZXIudXJsXHJcbiAgICB9KTtcclxuICAgIHNlbGYubWFya2Vycy5wdXNoKG1hcmtlcik7XHJcbiAgfSk7XHJcbn1cclxuIiwibGV0IHJlc3RhdXJhbnQ7XHJcbnZhciBtYXA7XHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxyXG4gKi9cclxud2luZG93LmluaXRNYXAgPSAoKSA9PiB7XHJcbiAgZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCgoZXJyb3IsIHJlc3RhdXJhbnQpID0+IHtcclxuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3IhXHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xyXG4gICAgICAgIHpvb206IDE2LFxyXG4gICAgICAgIGNlbnRlcjogcmVzdGF1cmFudC5sYXRsbmcsXHJcbiAgICAgICAgc2Nyb2xsd2hlZWw6IGZhbHNlXHJcbiAgICAgIH0pO1xyXG4gICAgICBmaWxsQnJlYWRjcnVtYigpO1xyXG4gICAgICBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHNlbGYucmVzdGF1cmFudCwgc2VsZi5tYXApO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogR2V0IGN1cnJlbnQgcmVzdGF1cmFudCBmcm9tIHBhZ2UgVVJMLlxyXG4gKi9cclxuZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCA9IChjYWxsYmFjaykgPT4ge1xyXG4gIGlmIChzZWxmLnJlc3RhdXJhbnQpIHsgLy8gcmVzdGF1cmFudCBhbHJlYWR5IGZldGNoZWQhXHJcbiAgICBjYWxsYmFjayhudWxsLCBzZWxmLnJlc3RhdXJhbnQpXHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG4gIGNvbnN0IGlkID0gZ2V0UGFyYW1ldGVyQnlOYW1lKCdpZCcpO1xyXG4gIGlmICghaWQpIHsgLy8gbm8gaWQgZm91bmQgaW4gVVJMXHJcbiAgICBlcnJvciA9ICdObyByZXN0YXVyYW50IGlkIGluIFVSTCdcclxuICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICB9IGVsc2Uge1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgKGVycm9yLCByZXN0YXVyYW50KSA9PiB7XHJcbiAgICAgIHNlbGYucmVzdGF1cmFudCA9IHJlc3RhdXJhbnQ7XHJcbiAgICAgIGlmICghcmVzdGF1cmFudCkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBmaWxsUmVzdGF1cmFudEhUTUwoKTtcclxuICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudClcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZVxyXG4gKi9cclxuZmlsbFJlc3RhdXJhbnRIVE1MID0gKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcclxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtbmFtZScpO1xyXG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xyXG5cclxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtYWRkcmVzcycpO1xyXG4gIGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xyXG5cclxuICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWltZycpO1xyXG4gIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZydcclxuICBpbWFnZS5hbHQgPSByZXN0YXVyYW50Lm5hbWUgKyBcIiByZXN0YXVyYW50J3MgY292ZXIgcGhvdG9cIlxyXG4gIGltYWdlLnNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcclxuXHJcbiAgY29uc3QgY3Vpc2luZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWN1aXNpbmUnKTtcclxuICBjdWlzaW5lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuY3Vpc2luZV90eXBlO1xyXG5cclxuICAvLyBmaWxsIG9wZXJhdGluZyBob3Vyc1xyXG4gIGlmIChyZXN0YXVyYW50Lm9wZXJhdGluZ19ob3Vycykge1xyXG4gICAgZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwoKTtcclxuICB9XHJcbiAgLy8gZmlsbCByZXZpZXdzXHJcbiAgZmlsbFJldmlld3NIVE1MKCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBvcGVyYXRpbmcgaG91cnMgSFRNTCB0YWJsZSBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwgPSAob3BlcmF0aW5nSG91cnMgPSBzZWxmLnJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSA9PiB7XHJcbiAgY29uc3QgaG91cnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1ob3VycycpO1xyXG4gIGZvciAobGV0IGtleSBpbiBvcGVyYXRpbmdIb3Vycykge1xyXG4gICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcclxuXHJcbiAgICBjb25zdCBkYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xyXG4gICAgZGF5LmlubmVySFRNTCA9IGtleTtcclxuICAgIHJvdy5hcHBlbmRDaGlsZChkYXkpO1xyXG5cclxuICAgIGNvbnN0IHRpbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xyXG4gICAgdGltZS5pbm5lckhUTUwgPSBvcGVyYXRpbmdIb3Vyc1trZXldO1xyXG4gICAgcm93LmFwcGVuZENoaWxkKHRpbWUpO1xyXG5cclxuICAgIGhvdXJzLmFwcGVuZENoaWxkKHJvdyk7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlIGFsbCByZXZpZXdzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuZmlsbFJldmlld3NIVE1MID0gKHJldmlld3MgPSBzZWxmLnJlc3RhdXJhbnQucmV2aWV3cykgPT4ge1xyXG4gIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWNvbnRhaW5lcicpO1xyXG4gIGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKTtcclxuICB0aXRsZS5pbm5lckhUTUwgPSAnUmV2aWV3cyc7XHJcbiAgY29udGFpbmVyLmFwcGVuZENoaWxkKHRpdGxlKTtcclxuXHJcbiAgaWYgKCFyZXZpZXdzKSB7XHJcbiAgICBjb25zdCBub1Jldmlld3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgICBub1Jldmlld3MuaW5uZXJIVE1MID0gJ05vIHJldmlld3MgeWV0ISc7XHJcbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQobm9SZXZpZXdzKTtcclxuICAgIHJldHVybjtcclxuICB9XHJcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1saXN0Jyk7XHJcbiAgcmV2aWV3cy5mb3JFYWNoKHJldmlldyA9PiB7XHJcbiAgICB1bC5hcHBlbmRDaGlsZChjcmVhdGVSZXZpZXdIVE1MKHJldmlldykpO1xyXG4gIH0pO1xyXG4gIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh1bCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgcmV2aWV3IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cclxuICovXHJcbmNyZWF0ZVJldmlld0hUTUwgPSAocmV2aWV3KSA9PiB7XHJcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xyXG5cclxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIG5hbWUuaW5uZXJIVE1MID0gcmV2aWV3Lm5hbWU7XHJcblxyXG5cclxuICBjb25zdCBkYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIGRhdGUuaW5uZXJIVE1MID0gcmV2aWV3LmRhdGU7XHJcbiAgZGF0ZS5pZCA9ICdyZXN0YXVyYW50LWRhdGUnO1xyXG5cclxuICBjb25zdCB1bCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7XHJcbiAgdWwuaWQgPSAncmVzdGF1cmFudC1iYXNpYy1uYXYnO1xyXG5cclxuICB1bC5hcHBlbmRDaGlsZChuYW1lKTtcclxuICB1bC5hcHBlbmRDaGlsZChkYXRlKTtcclxuICBsaS5hcHBlbmRDaGlsZCh1bCk7XHJcblxyXG5cclxuICBjb25zdCByYXRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgcmF0aW5nLmlubmVySFRNTCA9IGBSYXRpbmc6ICR7cmV2aWV3LnJhdGluZ31gO1xyXG4gIHJhdGluZy5pZCA9ICdyZXN0YXVyYW50LXJhdGluZyc7XHJcbiAgbGkuYXBwZW5kQ2hpbGQocmF0aW5nKTtcclxuXHJcbiAgY29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgY29tbWVudHMuaW5uZXJIVE1MID0gcmV2aWV3LmNvbW1lbnRzO1xyXG4gIGNvbW1lbnRzLmlkID0gJ3Jlc3RhdXJhbnQtY29tbWVudCc7XHJcbiAgbGkuYXBwZW5kQ2hpbGQoY29tbWVudHMpO1xyXG4gIGxpLnRhYkluZGV4ID0gJzAnO1xyXG5cclxuICByZXR1cm4gbGk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBBZGQgcmVzdGF1cmFudCBuYW1lIHRvIHRoZSBicmVhZGNydW1iIG5hdmlnYXRpb24gbWVudVxyXG4gKi9cclxuZmlsbEJyZWFkY3J1bWIgPSAocmVzdGF1cmFudD1zZWxmLnJlc3RhdXJhbnQpID0+IHtcclxuICBjb25zdCBicmVhZGNydW1iID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JyZWFkY3J1bWInKTtcclxuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcbiAgbGkuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xyXG4gIGJyZWFkY3J1bWIuYXBwZW5kQ2hpbGQobGkpO1xyXG59XHJcblxyXG4vKipcclxuICogR2V0IGEgcGFyYW1ldGVyIGJ5IG5hbWUgZnJvbSBwYWdlIFVSTC5cclxuICovXHJcbmdldFBhcmFtZXRlckJ5TmFtZSA9IChuYW1lLCB1cmwpID0+IHtcclxuICBpZiAoIXVybClcclxuICAgIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xyXG4gIG5hbWUgPSBuYW1lLnJlcGxhY2UoL1tcXFtcXF1dL2csICdcXFxcJCYnKTtcclxuICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYFs/Jl0ke25hbWV9KD0oW14mI10qKXwmfCN8JClgKSxcclxuICAgIHJlc3VsdHMgPSByZWdleC5leGVjKHVybCk7XHJcbiAgaWYgKCFyZXN1bHRzKVxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgaWYgKCFyZXN1bHRzWzJdKVxyXG4gICAgcmV0dXJuICcnO1xyXG4gIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1syXS5yZXBsYWNlKC9cXCsvZywgJyAnKSk7XHJcbn1cclxuIl19
